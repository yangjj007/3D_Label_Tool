# 过滤文件指标展示功能

## ✅ 功能概述

在左侧模型文件列表中,为已过滤的文件添加了指标信息展示功能:

1. **统计按钮**: 在已过滤文件列表中,对于包含指标数据的文件,在删除按钮左边添加了一个统计图标按钮
2. **指标详情弹窗**: 点击统计按钮会弹出一个漂亮的弹窗,展示该模型的完整指标信息
3. **智能显示**: 统计按钮仅在"已过滤"视图且文件含有 `filterMetrics` 数据时显示

## 🎯 实现细节

### 1. 统计按钮

在 `src/components/FileList/index.vue` 的文件列表项中添加了统计按钮:

```vue
<el-button 
  v-if="fileType === 'filtered' && file.filterMetrics"
  size="small" 
  type="info" 
  icon="DataAnalysis" 
  @click.stop="showMetricsDialog(file)"
  title="查看指标详情"
/>
```

**显示条件:**
- 当前视图为"已过滤" (`fileType === 'filtered'`)
- 文件对象包含 `filterMetrics` 数据

### 2. 指标详情弹窗

弹窗展示了以下几个部分的信息:

#### 📋 基本信息
- 文件名
- 文件大小

#### 🔢 几何统计
- 顶点数量 (vertexCount)
- 面片数量 (faceCount)
- 网格数量 (meshCount)
- 材质数量 (materialCount)

#### 🧊 体素化信息
- 体素分辨率 (voxelResolution)
- 占用体素数 (occupiedVoxels)
- 表面体素数 (surfaceVoxels)

#### 📊 复杂度指标
- **VVD** (体素顶点密度) - 带问号图标提示
- **VFC** (体素面片复杂度) - 带问号图标提示
- **VSC** (体素表面复杂度) - 带问号图标提示

#### ⏰ 计算信息
- 计算时间 (computedAt)
- 最后更新时间 (lastUpdated)
- 过滤时间 (filteredAt)
- 来源类型 (sourceType)

## 🎨 UI设计

### 视觉效果

1. **现代化卡片布局**: 使用网格布局自适应显示
2. **渐变高亮**: 复杂度指标使用紫色渐变背景突出显示
3. **悬停效果**: 指标项悬停时显示蓝色边框和阴影
4. **图标提示**: 复杂度指标带有问号图标,悬停显示详细说明
5. **响应式设计**: 指标项会根据窗口大小自动调整布局

### 颜色方案

- **主色调**: #409eff (Element Plus 蓝色)
- **高亮渐变**: #667eea → #764ba2 (紫色渐变)
- **背景**: #f8f9fa (浅灰色)
- **卡片**: #fff (白色)

## 📝 数据格式

指标数据来自文件对象的 `filterMetrics` 字段:

```json
{
  "filterMetrics": {
    "materialCount": 3,
    "voxelResolution": 64,
    "vertexCount": 8192,
    "faceCount": 4096,
    "meshCount": 5,
    "occupiedVoxels": 2048,
    "surfaceVoxels": 512,
    "VVD": 4.0,
    "VFC": 2.0,
    "VSC": 0.25,
    "computedAt": "2025-12-18T10:00:00Z",
    "lastUpdated": "2025-12-18T10:00:00Z"
  },
  "filteredAt": "2025-12-18T10:05:00Z",
  "sourceType": "labeled"
}
```

## 🔧 实现的功能函数

### 1. `showMetricsDialog(file)`
显示指标详情弹窗,将选中的文件信息传入。

### 2. `formatNumber(num)`
格式化数字,添加千位分隔符,例如: 8192 → 8,192

### 3. `formatMetric(value)`
格式化指标值,保留2位小数,例如: 4.0123 → 4.01

### 4. `formatDate(dateString)`
格式化日期时间,转换为中文本地化格式:
```
2025-12-18T10:00:00Z → 2025/12/18 18:00:00
```

## 🚀 使用方法

### 步骤 1: 准备已过滤的文件

1. 确保你已经完成了模型的过滤操作
2. 过滤后的文件会保存在 `files/filtered_files/` 目录
3. 每个文件对应的JSON元数据包含 `filterMetrics` 字段

### 步骤 2: 切换到"已过滤"视图

1. 在左侧文件列表顶部的下拉框中选择"已过滤"
2. 列表会显示所有已过滤的文件

### 步骤 3: 查看指标详情

1. 在文件列表项中,找到有指标数据的文件
2. 会看到删除按钮左边有一个蓝色的统计图标按钮
3. 点击统计按钮,弹出指标详情窗口
4. 在弹窗中查看完整的指标信息
5. 将鼠标悬停在VVD/VFC/VSC图标上查看详细说明
6. 点击"关闭"按钮或弹窗外部区域关闭弹窗

## 📸 界面示例

### 文件列表项
```
┌────────────────────────────────────────┐
│ model.glb                 [统计] [删除] │
│ 15.2 MB  ● 已过滤                      │
└────────────────────────────────────────┘
```

### 指标详情弹窗结构
```
┌─────────────────────────────────────────┐
│        模型指标详情              [X]     │
├─────────────────────────────────────────┤
│  基本信息                               │
│  ├─ 文件名: model.glb                   │
│  └─ 文件大小: 15.2 MB                   │
│                                         │
│  几何统计                               │
│  ├─ 顶点数量: 8,192                     │
│  ├─ 面片数量: 4,096                     │
│  ├─ 网格数量: 5                         │
│  └─ 材质数量: 3                         │
│                                         │
│  体素化信息                             │
│  ├─ 体素分辨率: 64                      │
│  ├─ 占用体素数: 2,048                   │
│  └─ 表面体素数: 512                     │
│                                         │
│  复杂度指标 (紫色渐变高亮)              │
│  ├─ VVD ?: 4.00                        │
│  ├─ VFC ?: 2.00                        │
│  └─ VSC ?: 0.25                        │
│                                         │
│  计算信息                               │
│  ├─ 计算时间: 2025/12/18 10:00:00      │
│  ├─ 最后更新: 2025/12/18 10:00:00      │
│  ├─ 过滤时间: 2025/12/18 10:05:00      │
│  └─ 来源类型: 已打标                    │
│                                         │
│                          [关闭]         │
└─────────────────────────────────────────┘
```

## 🎯 技术亮点

1. **条件渲染**: 使用 Vue 的 `v-if` 实现智能显示
2. **事件阻止**: 使用 `@click.stop` 防止触发文件选择事件
3. **响应式数据**: 使用 Vue 3 的 `ref` 管理弹窗状态
4. **格式化工具**: 提供数字、日期格式化函数
5. **工具提示**: 使用 Element Plus 的 Tooltip 组件
6. **现代化样式**: Grid 布局 + 渐变背景 + 悬停效果

## ⚠️ 注意事项

1. **统计按钮仅在已过滤视图显示**: 在"未打标"或"已打标"视图中不会显示
2. **需要指标数据**: 只有包含 `filterMetrics` 的文件才会显示统计按钮
3. **数据缺失处理**: 如果某些指标值为 `undefined` 或 `null`,会显示 "N/A"
4. **日期格式化**: 自动转换为中文本地化格式

## 🔗 相关文档

- [过滤系统使用指南](./FILTER_SYSTEM_README.md)
- [过滤系统实现总结](./FILTER_IMPLEMENTATION_SUMMARY.md)
- [过滤系统测试指南](./FILTER_SYSTEM_TESTING.md)

## 📦 文件修改清单

- ✅ `src/components/FileList/index.vue` - 添加统计按钮和指标详情弹窗
  - 新增统计按钮 (DataAnalysis 图标)
  - 新增指标详情对话框
  - 新增 `showMetricsDialog` 函数
  - 新增 `formatNumber`, `formatMetric`, `formatDate` 函数
  - 新增样式: `.metrics-detail`, `.metrics-section`, `.metric-item` 等

## 🎉 完成状态

✅ **功能已完全实现并测试通过**

所有代码已提交,无 linter 错误,可以正常使用!

