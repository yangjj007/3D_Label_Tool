# 提示词库功能测试指南

## 测试环境准备

### 1. 启动服务器
```bash
cd server
node index.js
```
或者
```bash
npm run server
```

确认看到输出：
```
🚀 服务器运行在 http://localhost:3001
```

### 2. 启动前端应用
```bash
npm run dev
```

## 功能测试清单

### ✅ 测试1：自动加载功能
**目的**: 验证应用启动时自动从文件加载提示词

**步骤**:
1. 确认 `prompts-library.json` 文件存在于项目根目录
2. 启动前端应用
3. 打开主界面，切换到"标签栏"（第一个标签）
4. 滚动到"提示词库"部分

**预期结果**:
- 提示词列表显示文件中的提示词
- 浏览器控制台显示："从服务器文件加载提示词成功"
- 选择规则（随机/加权）与文件中的设置一致

### ✅ 测试2：添加提示词
**目的**: 验证添加新提示词功能

**步骤**:
1. 点击"添加提示词"按钮
2. 在弹出的对话框中输入提示词内容
3. 点击"保存"按钮

**预期结果**:
- 新提示词出现在列表中
- 显示成功消息："提示词已更新"
- 可以在列表中看到新添加的提示词

### ✅ 测试3：编辑提示词
**目的**: 验证编辑现有提示词功能

**步骤**:
1. 点击提示词内容或编辑图标按钮
2. 在对话框中修改内容
3. 点击"保存"按钮

**预期结果**:
- 提示词内容更新
- 显示成功消息："提示词已更新"

### ✅ 测试4：删除提示词
**目的**: 验证删除提示词功能

**步骤**:
1. 添加至少2个提示词（如果只有1个）
2. 点击某个提示词的删除按钮
3. 确认删除

**预期结果**:
- 提示词从列表中移除
- 显示成功消息："提示词已删除"
- 如果只剩1个提示词，删除按钮应该被禁用

### ✅ 测试5：权重设置
**目的**: 验证加权模式下的权重设置功能

**步骤**:
1. 将选择规则切换到"加权"
2. 每个提示词旁边应该出现数字输入框
3. 修改某个提示词的权重值（1-100）

**预期结果**:
- 权重值成功更新
- 更改会自动保存到 localStorage

### ✅ 测试6：保存到文件
**目的**: 验证保存提示词到文件的功能

**步骤**:
1. 修改提示词（添加、编辑或删除）
2. 点击"保存到文件"按钮
3. 等待加载完成

**预期结果**:
- 显示成功消息："提示词库已保存到文件 (N 个提示词)"
- `prompts-library.json` 文件已更新（检查文件内容和修改时间）
- 文件内容格式正确，包含所有提示词

### ✅ 测试7：从文件加载
**目的**: 验证从文件加载提示词的功能

**步骤**:
1. 在界面中做一些修改（不保存到文件）
2. 点击"从文件加载"按钮
3. 确认加载

**预期结果**:
- 显示成功消息："已从文件加载 N 个提示词"
- 界面中的提示词恢复到文件中保存的状态
- 未保存的修改被丢弃

### ✅ 测试8：选择规则切换
**目的**: 验证随机/加权模式切换功能

**步骤**:
1. 在"随机"和"加权"之间切换
2. 观察界面变化
3. 保存到文件后验证

**预期结果**:
- 加权模式下显示权重输入框
- 随机模式下隐藏权重输入框
- 选择规则正确保存到文件

### ✅ 测试9：API 端点测试
**目的**: 验证服务器 API 功能

**步骤**:
1. 在浏览器或 Postman 中访问：
   ```
   GET http://localhost:3001/api/prompts-library
   ```

**预期结果**:
- 返回 JSON 数据
- 包含 `success: true` 和 `data` 字段
- data 中包含 prompts 数组和 selectionRule

**步骤**:
2. 使用 POST 请求保存数据：
   ```bash
   curl -X POST http://localhost:3001/api/prompts-library \
     -H "Content-Type: application/json" \
     -d '{"prompts":[{"id":"test-1","content":"测试提示词","weight":1}],"selectionRule":"random"}'
   ```

**预期结果**:
- 返回 `success: true`
- 文件已更新

### ✅ 测试10：错误处理
**目的**: 验证错误处理和提示

**测试场景A：服务器未启动**
1. 停止 Node.js 服务器
2. 点击"保存到文件"或"从文件加载"按钮

**预期结果**:
- 显示错误消息
- 不会崩溃

**测试场景B：空提示词库**
1. 删除所有提示词（只保留1个）
2. 尝试删除最后一个提示词

**预期结果**:
- 删除按钮被禁用
- 显示警告："至少需要保留一个提示词"

**测试场景C：文件不存在**
1. 重命名或删除 `prompts-library.json`
2. 点击"从文件加载"按钮

**预期结果**:
- 显示错误消息："加载失败"
- 应用继续使用 localStorage 中的数据

### ✅ 测试11：Git 同步测试
**目的**: 验证文件可以正常同步到 Git

**步骤**:
1. 修改提示词并保存到文件
2. 运行 `git status`
3. 确认 `prompts-library.json` 显示为已修改
4. 提交并推送：
   ```bash
   git add prompts-library.json
   git commit -m "测试提示词更新"
   git push
   ```

**预期结果**:
- 文件成功提交到 Git
- 其他成员可以拉取并使用最新的提示词

## 性能测试

### 大量提示词测试
1. 添加 50+ 个提示词
2. 测试保存和加载性能
3. 测试界面滚动流畅度

**预期结果**:
- 保存和加载在合理时间内完成（<2秒）
- 界面响应流畅
- 文件大小合理

## 浏览器兼容性测试

测试浏览器：
- ✅ Chrome/Edge (最新版)
- ✅ Firefox (最新版)
- ✅ Safari (macOS)

## 测试报告模板

```
测试日期: ____________________
测试人员: ____________________
浏览器: ____________________

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 自动加载 | ✅/❌ | |
| 添加提示词 | ✅/❌ | |
| 编辑提示词 | ✅/❌ | |
| 删除提示词 | ✅/❌ | |
| 权重设置 | ✅/❌ | |
| 保存到文件 | ✅/❌ | |
| 从文件加载 | ✅/❌ | |
| 选择规则切换 | ✅/❌ | |
| API 端点 | ✅/❌ | |
| 错误处理 | ✅/❌ | |
| Git 同步 | ✅/❌ | |

总体评价: ____________________
发现的问题: ____________________
```

## 常见问题排查

### 问题1：保存按钮无响应
- 检查浏览器控制台是否有错误
- 确认服务器正在运行
- 检查网络请求是否发送

### 问题2：加载失败
- 确认 `prompts-library.json` 文件存在
- 检查 JSON 格式是否正确
- 查看服务器日志

### 问题3：提示词丢失
- 检查浏览器 localStorage
- 从文件重新加载
- 从 Git 历史恢复文件

---

**测试完成后请将此文件标记为已测试**: ✅

