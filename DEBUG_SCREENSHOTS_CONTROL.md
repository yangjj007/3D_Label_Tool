# è°ƒè¯•æˆªå›¾åŠŸèƒ½æ§åˆ¶è¯´æ˜

## ğŸ“¸ åŠŸèƒ½è¯´æ˜

è°ƒè¯•æˆªå›¾åŠŸèƒ½ä¼šåœ¨æ‰¹é‡æ‰“æ ‡è¿‡ç¨‹ä¸­è‡ªåŠ¨ä¸‹è½½æ¯å¼ æˆªå›¾åˆ°æµè§ˆå™¨çš„ä¸‹è½½æ–‡ä»¶å¤¹ï¼Œç”¨äºè°ƒè¯•å’ŒéªŒè¯æ¸²æŸ“æ•ˆæœã€‚

**é»˜è®¤çŠ¶æ€**: âŒ **å·²å…³é—­**ï¼ˆä¸ä¼šä¸‹è½½æˆªå›¾ï¼‰

## ğŸ”§ å¦‚ä½•å¯ç”¨/ç¦ç”¨

### æ–¹æ³•1ï¼šä¿®æ”¹ä»£ç ï¼ˆæ°¸ä¹…å¯ç”¨ï¼‰

åœ¨ `src/views/modelEdit/index.vue` ä¸­ï¼Œæ‰¾åˆ°æ¸²æŸ“æ± åˆå§‹åŒ–ä»£ç ï¼š

```javascript
// å½“å‰ä»£ç ï¼ˆè°ƒè¯•æˆªå›¾å…³é—­ï¼‰
const poolSize = Math.min(concurrency, 10);
renderPool = new RenderPool(poolSize);
```

ä¿®æ”¹ä¸ºï¼š

```javascript
// å¯ç”¨è°ƒè¯•æˆªå›¾
const poolSize = Math.min(concurrency, 10);
const enableDebugScreenshots = true; // è®¾ç½®ä¸º true å¯ç”¨
renderPool = new RenderPool(poolSize, 1200, 900, enableDebugScreenshots);
```

### æ–¹æ³•2ï¼šè¿è¡Œæ—¶æ§åˆ¶ï¼ˆä¸´æ—¶å¯ç”¨ï¼‰

åœ¨æ‰¹é‡æ‰“æ ‡è¿‡ç¨‹ä¸­ï¼Œæ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ï¼Œæ‰§è¡Œï¼š

```javascript
// å¯ç”¨è°ƒè¯•æˆªå›¾ï¼ˆéœ€è¦åœ¨æ‰¹é‡æ‰“æ ‡å¼€å§‹å‰æ‰§è¡Œï¼‰
// æ³¨æ„ï¼šè¿™ä¸ªæ–¹æ³•éœ€è¦åœ¨ä»£ç ä¸­æš´éœ² renderPool åˆ°å…¨å±€
```

### æ–¹æ³•3ï¼šé€šè¿‡æ„é€ å‡½æ•°å‚æ•°

`OffscreenRenderModel` å’Œ `RenderPool` éƒ½æ”¯æŒè°ƒè¯•æˆªå›¾å¼€å…³ï¼š

```javascript
// OffscreenRenderModel
const renderer = new OffscreenRenderModel(
  1200,  // width
  900,   // height
  true   // enableDebugScreenshots - è®¾ç½®ä¸º true å¯ç”¨
);

// RenderPool
const pool = new RenderPool(
  5,     // poolSize
  1200,  // width
  900,   // height
  true   // enableDebugScreenshots - è®¾ç½®ä¸º true å¯ç”¨
);
```

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

| çŠ¶æ€ | ä¸‹è½½æˆªå›¾ | æ§åˆ¶å°æ—¥å¿— | æ€§èƒ½å½±å“ |
|------|---------|-----------|---------|
| å…³é—­ï¼ˆé»˜è®¤ï¼‰ | âŒ | âœ… | æ—  |
| å¯ç”¨ | âœ… | âœ… | è½»å¾®ï¼ˆä¸‹è½½æ“ä½œï¼‰ |

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### ä½•æ—¶å¯ç”¨è°ƒè¯•æˆªå›¾ï¼Ÿ

âœ… **åº”è¯¥å¯ç”¨**ï¼š
- è°ƒè¯•æ¸²æŸ“é—®é¢˜
- éªŒè¯é»„è‰²è¾¹æ¡†æ˜¯å¦æ­£ç¡®æ˜¾ç¤º
- æ£€æŸ¥æ¨¡å‹è´¨é‡
- å‘ä»–äººå±•ç¤ºæ¸²æŸ“æ•ˆæœ
- ç¬¬ä¸€æ¬¡ä½¿ç”¨å¹¶è¡Œæ¸²æŸ“

âŒ **ä¸éœ€è¦å¯ç”¨**ï¼š
- æ­£å¸¸æ‰¹é‡æ‰“æ ‡ï¼ˆåŠŸèƒ½å·²éªŒè¯ï¼‰
- å¤„ç†å¤§é‡æ–‡ä»¶ï¼ˆé¿å…ä¸‹è½½å¤ªå¤šæ–‡ä»¶ï¼‰
- ç”Ÿäº§ç¯å¢ƒä½¿ç”¨

## ğŸ“ ä»£ç ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šå¯ç”¨è°ƒè¯•æˆªå›¾çš„æ‰¹é‡æ‰“æ ‡

```javascript
// åœ¨ src/views/modelEdit/index.vue çš„ handleBatchTagging å‡½æ•°ä¸­

const handleBatchTagging = async ({ concurrency, viewKeys }) => {
  // ... å‰é¢çš„ä»£ç  ...

  // åˆå§‹åŒ–æ¸²æŸ“æ± ï¼ˆå¯ç”¨è°ƒè¯•æˆªå›¾ï¼‰
  const poolSize = Math.min(concurrency, 10);
  const enableDebugScreenshots = true; // ğŸ‘ˆ è®¾ç½®ä¸º true
  renderPool = new RenderPool(poolSize, 1200, 900, enableDebugScreenshots);
  
  await renderPool.initialize();
  
  // ... åç»­ä»£ç  ...
};
```

### ç¤ºä¾‹2ï¼šåŠ¨æ€æ§åˆ¶ï¼ˆè¿è¡Œæ—¶åˆ‡æ¢ï¼‰

```javascript
// åœ¨ OffscreenRenderModel å®ä¾‹ä¸Šè°ƒç”¨
renderer.setDebugScreenshots(true);  // å¯ç”¨
renderer.setDebugScreenshots(false); // ç¦ç”¨
```

## ğŸ” éªŒè¯çŠ¶æ€

### æ£€æŸ¥æ˜¯å¦å¯ç”¨

åœ¨æ§åˆ¶å°æŸ¥çœ‹æ—¥å¿—ï¼š

**å·²ç¦ç”¨**ï¼ˆé»˜è®¤ï¼‰ï¼š
```
[OffscreenRenderModel] å¼€å§‹æ•è·æè´¨: Material_001
[OffscreenRenderModel] æˆªå›¾å¤§å°: 45678 bytes
// æ²¡æœ‰ "è°ƒè¯•å›¾ç‰‡å·²ä¿å­˜" çš„æ—¥å¿—
```

**å·²å¯ç”¨**ï¼š
```
[OffscreenRenderModel] å¼€å§‹æ•è·æè´¨: Material_001
[OffscreenRenderModel] æˆªå›¾å¤§å°: 45678 bytes
[OffscreenRenderModel] è°ƒè¯•å›¾ç‰‡å·²ä¿å­˜: debug_1705123456789_Material_001_main_0.png
```

## ğŸ“ ä¸‹è½½çš„æ–‡ä»¶

å¯ç”¨åï¼Œæˆªå›¾ä¼šè‡ªåŠ¨ä¸‹è½½åˆ°æµè§ˆå™¨çš„ä¸‹è½½æ–‡ä»¶å¤¹ï¼š

```
ä¸‹è½½æ–‡ä»¶å¤¹/
â”œâ”€â”€ debug_1705123456789_Material_001_main_0.png
â”œâ”€â”€ debug_1705123456789_Material_001_top_1.png
â”œâ”€â”€ debug_1705123456789_Material_001_side_2.png
â”œâ”€â”€ debug_1705123456789_Material_001_axial_3.png
â”œâ”€â”€ debug_1705123456790_Material_002_main_0.png
â””â”€â”€ ...
```

æ–‡ä»¶å‘½åæ ¼å¼ï¼š
```
debug_[æ—¶é—´æˆ³]_[æè´¨åç§°]_[è§†è§’]_[ç´¢å¼•].png
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ–‡ä»¶æ•°é‡
- æ¯ä¸ªæè´¨ Ã— æ¯ä¸ªè§†è§’ = 1 å¼ æˆªå›¾
- ä¾‹å¦‚ï¼š10ä¸ªæ–‡ä»¶ Ã— 5ä¸ªæè´¨ Ã— 4ä¸ªè§†è§’ = **200å¼ æˆªå›¾**
- å¯ç”¨å‰è¯·ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´

### 2. æµè§ˆå™¨ä¸‹è½½è®¾ç½®
- é¦–æ¬¡ä¸‹è½½æ—¶ï¼Œæµè§ˆå™¨å¯èƒ½è¯¢é—®æ˜¯å¦å…è®¸å¤šä¸ªä¸‹è½½
- è¯·é€‰æ‹©"å…è®¸"æˆ–"æ€»æ˜¯å…è®¸"

### 3. æ€§èƒ½å½±å“
- ä¸‹è½½æ“ä½œä¼šå ç”¨å°‘é‡æ—¶é—´ï¼ˆæ¯å¼ çº¦ 10-50msï¼‰
- å¯¹æ•´ä½“æ‰¹é‡æ‰“æ ‡é€Ÿåº¦å½±å“å¾ˆå°

### 4. æ¸…ç†æ–‡ä»¶
è®°å¾—å®šæœŸæ¸…ç†ä¸‹è½½æ–‡ä»¶å¤¹ä¸­çš„è°ƒè¯•æˆªå›¾ï¼š
```bash
# Windows
del /Q "%USERPROFILE%\Downloads\debug_*.png"

# Mac/Linux
rm ~/Downloads/debug_*.png
```

## ğŸ“ æœ€ä½³å®è·µ

### æ¨èçš„å·¥ä½œæµç¨‹

1. **é¦–æ¬¡ä½¿ç”¨**ï¼šå¯ç”¨è°ƒè¯•æˆªå›¾
   - éªŒè¯æ¸²æŸ“æ•ˆæœ
   - æ£€æŸ¥é»„è‰²è¾¹æ¡†
   - ç¡®è®¤è´¨é‡æ»¡æ„

2. **éªŒè¯å®Œæˆå**ï¼šå…³é—­è°ƒè¯•æˆªå›¾
   - æ­£å¸¸æ‰¹é‡æ‰“æ ‡
   - é¿å…ä¸‹è½½å¤§é‡æ–‡ä»¶

3. **é‡åˆ°é—®é¢˜æ—¶**ï¼šä¸´æ—¶å¯ç”¨
   - é‡ç°é—®é¢˜
   - ä¿å­˜æˆªå›¾ç”¨äºåˆ†æ
   - é—®é¢˜è§£å†³åå…³é—­

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜ï¼šå¯ç”¨äº†ä½†æ²¡æœ‰ä¸‹è½½æˆªå›¾

**æ£€æŸ¥1**ï¼šç¡®è®¤å‚æ•°ä¼ é€’æ­£ç¡®
```javascript
// ç¡®ä¿ç¬¬4ä¸ªå‚æ•°æ˜¯ true
new RenderPool(5, 1200, 900, true);
```

**æ£€æŸ¥2**ï¼šæŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—
```
[OffscreenRenderModel] è°ƒè¯•å›¾ç‰‡å·²ä¿å­˜: ...
```

**æ£€æŸ¥3**ï¼šæµè§ˆå™¨ä¸‹è½½è®¾ç½®
- æ£€æŸ¥æ˜¯å¦é˜»æ­¢äº†è‡ªåŠ¨ä¸‹è½½
- æŸ¥çœ‹ä¸‹è½½å†å²è®°å½•

### é—®é¢˜ï¼šä¸‹è½½å¤ªå¤šæ–‡ä»¶å¯¼è‡´å¡é¡¿

**è§£å†³**ï¼š
1. é™ä½å¹¶å‘åº¦
2. å‡å°‘è§†è§’æ•°é‡
3. å…³é—­è°ƒè¯•æˆªå›¾

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `src/utils/OffscreenRenderModel.js` - æ¸²æŸ“å™¨å®ç°
- `src/utils/RenderPool.js` - æ¸²æŸ“æ± ç®¡ç†
- `src/views/modelEdit/index.vue` - æ‰¹é‡æ‰“æ ‡é€»è¾‘

## ğŸ¯ å¿«é€Ÿå‚è€ƒ

```javascript
// å…³é—­ï¼ˆé»˜è®¤ï¼‰
new RenderPool(5); // æˆ–
new RenderPool(5, 1200, 900, false);

// å¯ç”¨
new RenderPool(5, 1200, 900, true);

// è¿è¡Œæ—¶æ§åˆ¶
renderer.setDebugScreenshots(true);  // å¯ç”¨
renderer.setDebugScreenshots(false); // ç¦ç”¨
```

---

**å½“å‰çŠ¶æ€**: âŒ **å·²å…³é—­**ï¼ˆé»˜è®¤ï¼‰
**å»ºè®®**: ä»…åœ¨éœ€è¦è°ƒè¯•æ—¶å¯ç”¨
**æ€§èƒ½å½±å“**: è½»å¾®

