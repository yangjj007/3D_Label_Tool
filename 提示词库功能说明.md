# 提示词库持久化功能 - 使用说明

## 🎉 功能已完成

您的需求已经全部实现：

✅ 在主界面右边标签栏的"提示词库"中添加了"保存"按钮  
✅ 点击后将所有提示词持久化到 JSON 文件  
✅ 结构化存储提示词数据  
✅ 提示词文件**不在** `.gitignore` 中，可以同步到 GitHub  

---

## 📁 新增文件

### 1. `prompts-library.json` （核心配置文件）
- 位置：项目根目录
- 作用：存储所有提示词配置
- 格式：结构化的 JSON 格式
- **重要**：此文件会被 Git 追踪，可以提交到 GitHub

### 2. 文档文件
- `prompts-library-guide.md` - 详细使用指南
- `CHANGELOG_PROMPTS.md` - 功能更新日志
- `TEST_PROMPTS_FEATURE.md` - 测试指南
- `提示词库功能说明.md` - 本文件（中文简要说明）

---

## 🚀 快速开始

### 第一步：启动服务器
```bash
# 在项目根目录下
node server/index.js
```

看到这个提示表示服务器启动成功：
```
🚀 服务器运行在 http://localhost:3001
```

### 第二步：启动前端
```bash
npm run dev
```

### 第三步：使用功能

1. **打开应用**，切换到右侧"标签栏"（第一个图标，聊天气泡图标）
2. **滚动到"提示词库"部分**，可以看到：
   - 提示词列表
   - 两个新按钮：**"从文件加载"** 和 **"保存到文件"**

---

## 💡 主要功能

### 🔹 保存到文件
1. 添加或修改提示词后
2. 点击 **"保存到文件"** 按钮（蓝色，有文档图标）
3. 看到提示："提示词库已保存到文件 (N 个提示词)"
4. `prompts-library.json` 文件已更新

### 🔹 从文件加载
1. 点击 **"从文件加载"** 按钮（绿色，有文件夹图标）
2. 所有提示词从文件重新加载
3. 看到提示："已从文件加载 N 个提示词"

### 🔹 自动加载
- 应用启动时会**自动从文件加载**提示词
- 无需手动点击"从文件加载"
- 优先使用文件中的配置，确保团队同步

---

## 📤 同步到 GitHub

### 保存并提交
```bash
# 1. 在应用中修改提示词，点击"保存到文件"

# 2. 提交到 Git
git add prompts-library.json
git commit -m "更新提示词库"
git push origin main
```

### 其他人获取更新
```bash
# 1. 拉取最新代码
git pull origin main

# 2. 重启应用，自动加载最新提示词
npm run dev
```

---

## 📋 提示词文件格式

`prompts-library.json` 的结构：

```json
{
  "version": "1.0.0",
  "lastUpdated": "2025-12-09T12:00:00.000Z",
  "description": "VLM提示词库配置文件",
  "selectionRule": "random",
  "prompts": [
    {
      "id": "prompt-1234567890",
      "content": "提示词内容...",
      "weight": 1,
      "updatedAt": "2025-12-09T12:00:00.000Z"
    }
  ]
}
```

### 字段说明：
- `version`: 配置文件版本号
- `lastUpdated`: 最后保存时间
- `selectionRule`: 选择模式（"random" 随机 / "weighted" 加权）
- `prompts`: 提示词数组
  - `id`: 唯一标识符
  - `content`: 提示词内容
  - `weight`: 权重值（1-100）
  - `updatedAt`: 更新时间

---

## ⚙️ 界面说明

在"提示词库"部分，您会看到：

```
┌─────────────────────────────────────┐
│  提示词库      [随机] [加权]         │
├─────────────────────────────────────┤
│  [从文件加载] [保存到文件]          │  ← 新增的两个按钮
├─────────────────────────────────────┤
│  📝 提示词 1...         [编辑][删除]│
│  📝 提示词 2...         [编辑][删除]│
│  📝 提示词 3...         [编辑][删除]│
├─────────────────────────────────────┤
│  [添加提示词]                        │
└─────────────────────────────────────┘
```

### 按钮功能：
- **从文件加载** - 绿色按钮，文件夹图标，重新从文件读取提示词
- **保存到文件** - 蓝色按钮，文档图标，将当前提示词保存到文件
- **添加提示词** - 创建新的提示词
- **编辑** - 修改现有提示词
- **删除** - 移除提示词（至少保留一个）

---

## ⚠️ 注意事项

### 1. 服务器必须运行
- 保存和加载功能需要 Node.js 服务器
- 如果服务器未启动，会显示错误提示
- 启动命令：`node server/index.js`

### 2. Git 冲突处理
- 多人同时修改提示词可能导致冲突
- 建议：一次只有一人修改，或使用 Git 分支
- 冲突时需要手动合并 JSON 文件

### 3. 文件位置
- `prompts-library.json` 位于项目**根目录**
- **不要**将此文件添加到 `.gitignore`
- 已确认：文件不在 `.gitignore` 中 ✅

### 4. 数据备份
- 重要提示词建议定期备份
- Git 历史可以恢复之前的版本
- 可以手动复制 `prompts-library.json` 作为备份

---

## 🐛 常见问题

### Q1: 点击"保存到文件"没反应？
**A**: 检查服务器是否运行
```bash
node server/index.js
```
确认看到 "🚀 服务器运行在 http://localhost:3001"

### Q2: 提示词保存后其他人看不到？
**A**: 需要提交到 Git 并推送
```bash
git add prompts-library.json
git commit -m "更新提示词"
git push
```

### Q3: 加载提示词失败？
**A**: 
1. 检查 `prompts-library.json` 文件是否存在
2. 检查 JSON 格式是否正确
3. 查看浏览器控制台的错误信息

### Q4: 修改后没有保存？
**A**: 修改提示词后需要点击 **"保存到文件"** 按钮，否则只保存在浏览器缓存中

---

## 📚 扩展阅读

详细文档请查看：
- `prompts-library-guide.md` - 完整使用指南（英文）
- `CHANGELOG_PROMPTS.md` - 更新日志
- `TEST_PROMPTS_FEATURE.md` - 测试指南

---

## 🎯 总结

现在您可以：
1. ✅ 在界面中管理提示词（添加、编辑、删除）
2. ✅ 点击"保存到文件"将提示词持久化到 `prompts-library.json`
3. ✅ 点击"从文件加载"重新读取文件中的提示词
4. ✅ 应用启动时自动从文件加载提示词
5. ✅ 通过 Git 将提示词同步到 GitHub，供团队使用

**享受您的新功能！** 🎉

---

**更新日期**: 2025-12-09  
**版本**: 1.0.0

